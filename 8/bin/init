#!/usr/bin/env bash

set -e

if [[ -n "${DEBUG}" ]]; then
    set -x
fi

if [[ ! -f "${APP_ROOT}/web/index.php" ]]; then
    echo >&2 "${APP_NAME} not found in ${APP_ROOT} - copying now..."
    rsync -a "/usr/src/drupal/" "${APP_ROOT}/"
    echo >&2 "Complete! ${APP_NAME} has been successfully copied to ${APP_ROOT}"

    if [[ -z "${WODBY_APP_NAME}" ]]; then
        su-exec www-data mkdir -p "${FILES_DIR}/config/sync_dir"
        su-exec wodby gotpl /etc/gotpl/settings.php.tpl >> "${APP_ROOT}/web/sites/default/settings.php"
    fi
fi
